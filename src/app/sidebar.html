<aside class="sidebar">
    <div class="sidebar-header">
        <h2>Aktif Siparişler</h2>
        <div class="sidebar-stats">
            <span class="stat-badge">{{ activeOrders().length }}</span>
        </div>
    </div>

    <div class="sidebar-content">
        <div class="orders-list" *ngIf="activeOrders().length > 0; else noActiveOrdersTemplate">
            <div class="order-item" *ngFor="let order of activeOrders()">
                <div class="order-item-header">
                    <div class="order-info">
                        <div class="order-code">#{{ order.code }}</div>
                        <div class="order-time">{{ order.createdAt | date:'HH:mm' }}</div>
                    </div>
                    <div class="order-status-badge" [class]="'status-' + order.status">
                        {{ getStatusText(order.status) }}
                    </div>
                </div>

                <div class="order-item-details">
                    <div class="customer-info">
                        <div class="customer-name">{{ order.customer?.name || 'Müşteri' }}</div>
                        <div class="customer-phone">{{ order.customer?.phone || 'Telefon yok' }}</div>
                    </div>
                    <div class="order-info">
                        <div class="order-total">{{ order.totalAmount | currency:'TRY':'symbol':'1.2-2' }}</div>
                        <div class="order-items">{{ order.items?.length || 0 }} ürün</div>
                    </div>
                </div>

                <div class="order-item-actions">
                    <!-- Debug: Status bilgisi -->
                    <div
                        style="font-size: 10px; color: #999; margin-bottom: 8px; background: #f0f0f0; padding: 4px; border-radius: 4px;">
                        <div>Debug: Status = {{ order.status }}</div>
                        <div>Callback URL'ler: {{ getCallbackUrlsInfo(order) }}</div>
                    </div>

                    <!-- Sadece callback URL varsa butonları göster -->
                    <button class="status-btn preparing"
                        *ngIf="(order.status === 'pending') && hasCallbackUrl(order, 'orderAcceptedUrl')"
                        (click)="updateOrderStatus(order, 'order_accepted')">
                        <span class="btn-icon">✅</span>
                        <span class="btn-text">Kabul Et</span>
                    </button>

                    <button class="status-btn rejected"
                        *ngIf="(order.status === 'pending') && hasCallbackUrl(order, 'orderRejectedUrl')"
                        (click)="updateOrderStatus(order, 'order_rejected')">
                        <span class="btn-icon">❌</span>
                        <span class="btn-text">Reddet</span>
                    </button>

                    <button class="status-btn picked-up"
                        *ngIf="(order.status === 'accepted' || order.status === 'order_accepted' || order.status === 'preparing' || order.status === 'order_preparing') && hasCallbackUrl(order, 'orderPickedUpUrl')"
                        (click)="updateOrderStatus(order, 'order_picked_up')">
                        <span class="btn-icon">🚚</span>
                        <span class="btn-text">Kurye Aldı</span>
                    </button>

                    <button class="status-btn prepared"
                        *ngIf="(order.status === 'accepted' || order.status === 'order_accepted' || order.status === 'preparing' || order.status === 'order_preparing') && hasCallbackUrl(order, 'orderPreparedUrl')"
                        (click)="markOrderPrepared(order)">
                        <span class="btn-icon">👨‍🍳</span>
                        <span class="btn-text">Yemek Hazır</span>
                    </button>

                    <button class="status-btn product-modification"
                        *ngIf="(order.status === 'accepted' || order.status === 'order_accepted') && hasCallbackUrl(order, 'orderProductModificationUrl')"
                        (click)="modifyProduct(order)">
                        <span class="btn-icon">📝</span>
                        <span class="btn-text">Ürün Değiştir</span>
                    </button>
                </div>

                <div class="order-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" [style.width.%]="getProgressPercentage(order.status)"></div>
                    </div>
                    <div class="progress-steps">
                        <div class="step" [class.active]="order.status !== 'pending'">
                            <span class="step-icon">📋</span>
                            <span class="step-text">Kabul</span>
                        </div>
                        <div class="step"
                            [class.active]="['preparing', 'ready', 'prepared', 'delivered', 'order_preparing', 'order_ready', 'order_prepared', 'order_delivered', 'picked_up', 'order_picked_up'].includes(order.status)">
                            <span class="step-icon">👨‍🍳</span>
                            <span class="step-text">Hazırlanıyor</span>
                        </div>
                        <div class="step"
                            [class.active]="['ready', 'prepared', 'delivered', 'order_ready', 'order_prepared', 'order_delivered'].includes(order.status)">
                            <span class="step-icon">✅</span>
                            <span class="step-text">Hazır</span>
                        </div>
                        <div class="step"
                            [class.active]="order.status === 'delivered' || order.status === 'order_delivered'">
                            <span class="step-icon">🎉</span>
                            <span class="step-text">Teslim</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <ng-template #noActiveOrdersTemplate>
            <div class="no-active-orders">
                <div class="no-orders-content">
                    <div class="no-orders-icon">📋</div>
                    <h3>Aktif Sipariş Yok</h3>
                    <p>Kabul edilen siparişler burada görünecek</p>
                </div>
            </div>
        </ng-template>
    </div>
</aside>